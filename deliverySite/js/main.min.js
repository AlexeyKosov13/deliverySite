!function(){if(!window.matchMedia("(max-width: 992px").matches){let t=document.querySelector(".header");window.addEventListener("scroll",()=>{window.pageYOffset>0?t.classList.add("is--active"):t.classList.remove("is--active")})}}(),function(){const t=document.querySelector("body");const e=t=>{t.classList.remove("is--active")},r=()=>{t.classList.toggle("no-scroll")};t.addEventListener("click",t=>{let e=((t,e)=>{let r=t;for(;r;){let t=r.getAttribute(e);if(t)return t;r=r.parentElement}return null})(t.target,"data-popup");if(null===e)return;t.preventDefault();let n=document.querySelector("."+e);n&&((t=>{t.classList.add("is--active")})(n),r())}),t.addEventListener("keydown",t=>{if(27!==t.keyCode)return;let n=document.querySelector(".popup");n&&(e(n),r())}),t.addEventListener("click",t=>{const n=t.target;if(n.classList.contains("popup-close")||n.classList.contains("popup__inner")){const t=((t,e)=>{let r=t;for(;r;){if(r.classList.contains(e))return r;r=r.parentElement}return null})(n,"popup");e(t),r()}})}(),function(){const t=document.querySelector("body");t.addEventListener("click",t=>{const e=((t,e)=>{let r=t;for(;r;){let t=r.getAttribute(e);if(t)return t;r=r.parentElement}return null})(t.target,"data-scroll-to");if(null===e)return;t.preventDefault();const r=document.querySelector("."+e);r&&(t=>{const e=t.getBoundingClientRect().top+window.pageYOffset,r=document.querySelector(".header").clientHeight;window.scrollTo(0,e-r)})(r)})}(),function(){!async function(){const n=await fetch("./js/products.json");t=await n.json(),r(e,t)}();let t=[];const e=document.querySelector(".products__items");const r=(t,e)=>{(t=>{for(;t.firstChild;)t.removeChild(t.firstChild)})(t),e.forEach((function(e){const r=`\n    <div class="products__item" data-category="${e.data}">\n      <div class="products__wrapper card" data-id="${e.id}">\n        <img class="product-img" src="img/roll/${e.imgSrc}" alt="">\n      <div class="card__body text-center">\n        <h4 class="item-title">${e.title}</h4>\n        <p><small data-items-in-box class="text-muted">${e.itemsInBox} шт.</small></p>\n\n        <div class="details-wrapper">\n          <div class="items counter-wrapper">\n            <div class="items__control" data-action="minus">-</div>\n            <div class="items__current" data-counter>1</div>\n            <div class="items__control" data-action="plus">+</div>\n          </div>\n\n          <div class="price">\n            <div class="price__weight">${e.weight}г.</div>\n            <div class="price__currency">${e.price} ₽</div>\n          </div>\n        </div>\n\n        <button data-cart type="button" class="btn btn-block btn-outline-warning">+ в корзину</button>\n\n      </div>\n    </div>\n  </div>\n    `;t.insertAdjacentHTML("beforeend",r)}))},n=document.querySelector(".products__list");n.addEventListener("click",i=>{const c=i.target,a=JSON.parse(JSON.stringify(t));let s=((t,e)=>{let r=t;for(;r;){if(r.classList.contains(e))return r;r=r.parentElement}return null})(c,"products__btn");if(null===s||s.classList.contains("is--active"))return;i.preventDefault();let o=s.getAttribute("data-filter");if(n.querySelector(".products__btn.is--active").classList.remove("is--active"),s.classList.add("is--active"),"all"===o)return void r(e,a);let d=[];for(let t=0;t<a.length;t++){let e=a[t];e.data===o&&d.push(e)}r(e,d)})}();const order=document.querySelector(".order"),orderTotal=document.querySelector(".order__total-price"),cartWrapper=document.querySelector(".cart-wrapper"),orderWrapper=document.querySelector(".order__list");let cart=[];function toggleCartStatus(){const t=document.querySelector(".products__cart"),e=document.querySelector("[data-cart-empty]"),r=document.querySelector("#order-form");t.children.length>0?(e.classList.add("none"),r.classList.remove("none")):(e.classList.remove("none"),r.classList.add("none"))}function calcCartPrice(){const t=document.querySelector(".total-price"),e=document.querySelectorAll(".cart-item"),r=document.querySelector(".delivery-cost"),n=document.querySelector("[data-cart-delivery]");let i=0;e.forEach((function(t){const e=t.querySelector("[data-counter]"),r=t.querySelector(".price__currency"),n=parseInt(e.innerText)*parseInt(r.innerText);i+=n})),t.innerText=i,orderTotal.innerText=`Итого: ${i} руб.`,i>0?n.classList.remove("none"):n.classList.add("none"),i>=600?(r.classList.add("free"),r.innerText="бесплатно"):(r.classList.remove("free"),r.innerText="250 ₽")}function init(){var t=new ymaps.Map("map",{center:[56.141051,47.194952],zoom:12}),e=document.querySelector("#myadress").innerHTML;ymaps.geocode(e).then((function(r){var n=r.geoObjects.get(0).geometry.getCoordinates();t.setCenter(n,14,{checkZoomRange:!0});var i=new ymaps.Placemark(n,{hintContent:e,balloonContent:"Время работы: Пн-Пт, с 9 до 20"},{iconLayout:"default#image",iconImageHref:"../img/icon.svg",iconImageSize:[40,52],iconImageOffset:[-5,-38]},{preset:"islands#redDotIcon"});t.geoObjects.add(i)}))}order.addEventListener("click",()=>{cart.forEach(t=>{const e=`\n            <div class="cart-item order__item" data-category="${t.data}" data-id="${t.id}">\n                    <div class="cart-item__img order__img">\n                        <img src="${t.imgSrc}" alt="${t.title}">\n                    </div>\n                    <div class="cart-item__desc order__descr">\n                        <div class="cart-item__title">${t.title}</div>\n                        <div class="cart-item__weight">${t.itemsInBox} / ${t.weight}</div>\n\n                        <div class="cart-item__details">\n                            <div class="price">\n                                <div class="price__currency">${t.price}</div>\n                            </div>\n                        </div>\n                    </div>\n                  <div class="order__total"> x ${t.counter}</div>\n            </div>`;orderWrapper.insertAdjacentHTML("afterbegin",e)})}),window.addEventListener("click",(function(t){let e,r;if(t.target.closest(".cart-wrapper")&&(r=t.target.closest(".cart-item").dataset.id),"plus"===t.target.dataset.action||"minus"===t.target.dataset.action){e=t.target.closest(".counter-wrapper").querySelector("[data-counter]")}"plus"===t.target.dataset.action&&(e.innerText=++e.innerText,cart.map(t=>{t.id===r&&t.counter++})),"minus"===t.target.dataset.action&&(parseInt(e.innerText)>1?(e.innerText=--e.innerText,cart.map(t=>{t.id===r&&t.counter--})):t.target.closest(".cart-wrapper")&&1===parseInt(e.innerText)&&(t.target.closest(".cart-item").remove(),cart.map((t,e)=>{t.id===r&&cart.splice(e,1)}),toggleCartStatus(),calcCartPrice())),t.target.hasAttribute("data-action")&&t.target.closest(".cart-wrapper")&&calcCartPrice()})),window.addEventListener("click",(function(t){if(t.target.hasAttribute("data-cart")){const e=t.target.closest(".card"),r={id:e.dataset.id,imgSrc:e.querySelector(".product-img").getAttribute("src"),title:e.querySelector(".item-title").innerText,itemsInBox:e.querySelector("[data-items-in-box]").innerText,weight:e.querySelector(".price__weight").innerText,price:e.querySelector(".price__currency").innerText,counter:e.querySelector("[data-counter]").innerText};cart.push(r);const n=cartWrapper.querySelector(`[data-id="${r.id}"]`),i=t=>{const e=`\n            <div class="cart-item" data-id="${t.id}">\n                <div class="cart-item__top">\n                    <div class="cart-item__img">\n                        <img src="${t.imgSrc}" alt="${t.title}">\n                    </div>\n                    <div class="cart-item__desc">\n                        <div class="cart-item__title">${t.title}</div>\n                        <div class="cart-item__weight">${t.itemsInBox} / ${t.weight}</div>\n\n                        <div class="cart-item__details">\n                            <div class="items items--small counter-wrapper">\n                                <div class="items__control" data-action="minus">-</div>\n                                <div class="items__current" data-counter="">${t.counter}</div>\n                                <div class="items__control" data-action="plus">+</div>\n                            </div>\n\n                            <div class="price">\n                                <div class="price__currency">${t.price}</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>`;cartWrapper.insertAdjacentHTML("beforeend",e)};if(n){const t=n.querySelector("[data-counter]");t.innerText=parseInt(t.innerText)+parseInt(r.counter)}else i(r);e.querySelector("[data-counter]").innerText="1",toggleCartStatus(),calcCartPrice()}})),ymaps.ready(init);