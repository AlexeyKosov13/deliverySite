const burger=document.querySelector(".burger"),order=document.querySelector(".order"),close=document.querySelector(".menu__close"),closeOrder=document.querySelector(".menuOrder__close"),menu=document.querySelector(".menu"),popup=document.querySelector(".popup"),menuOrder=document.querySelector(".menu__order"),orderTotal=document.querySelector(".order__total-price"),cartWrapper=document.querySelector(".cart-wrapper"),orderWrapper=document.querySelector(".order__list"),orderBtn=document.querySelector(".order__btn"),productsContainer=document.querySelector(".products__items");let cart=[];async function getProducts(){const e=await fetch("./js/products.json");renderProducts(await e.json())}function renderProducts(e){e.forEach((function(e){const t=`\n    <div class="products__item ">\n    <div class="products__wrapper card" data-id="${e.id}">\n      <img class="product-img" src="img/roll/${e.imgSrc}" alt="">\n      <div class="card__body text-center">\n        <h4 class="item-title">${e.title}</h4>\n        <p><small data-items-in-box class="text-muted">6 шт.</small></p>\n\n        <div class="details-wrapper">\n          <div class="items counter-wrapper">\n            <div class="items__control" data-action="minus">-</div>\n            <div class="items__current" data-counter>1</div>\n            <div class="items__control" data-action="plus">+</div>\n          </div>\n\n          <div class="price">\n            <div class="price__weight">${e.weight}г.</div>\n            <div class="price__currency">${e.price} ₽</div>\n          </div>\n        </div>\n\n        <button data-cart type="button" class="btn btn-block btn-outline-warning">+ в корзину</button>\n\n      </div>\n    </div>\n  </div>\n    `;productsContainer.insertAdjacentHTML("beforeend",t)}))}function toggleCartStatus(){const e=document.querySelector(".products__cart"),t=document.querySelector("[data-cart-empty]"),r=document.querySelector("#order-form");e.children.length>0?(t.classList.add("none"),r.classList.remove("none")):(t.classList.remove("none"),r.classList.add("none"))}function calcCartPrice(){const e=document.querySelector(".total-price"),t=document.querySelectorAll(".cart-item"),r=document.querySelector(".delivery-cost"),n=document.querySelector("[data-cart-delivery]");let c=0;t.forEach((function(e){const t=e.querySelector("[data-counter]"),r=e.querySelector(".price__currency"),n=parseInt(t.innerText)*parseInt(r.innerText);c+=n})),e.innerText=c,orderTotal.innerText=`Итого: ${c} руб.`,c>0?n.classList.remove("none"):n.classList.add("none"),c>=600?(r.classList.add("free"),r.innerText="бесплатно"):(r.classList.remove("free"),r.innerText="250 ₽")}function init(){var e=new ymaps.Map("map",{center:[56.141051,47.194952],zoom:12}),t=document.querySelector("#myadress").innerHTML;ymaps.geocode(t).then((function(r){var n=r.geoObjects.get(0).geometry.getCoordinates();e.setCenter(n,14,{checkZoomRange:!0});var c=new ymaps.Placemark(n,{hintContent:t,balloonContent:"Время работы: Пн-Пт, с 9 до 20"},{iconLayout:"default#image",iconImageHref:"../img/icon.svg",iconImageSize:[30,42],iconImageOffset:[-5,-38]},{preset:"islands#redDotIcon"});e.geoObjects.add(c)}))}burger.addEventListener("click",()=>{menu.classList.add("menu--visible")}),orderBtn.addEventListener("click",e=>{e.preventDefault(),menuOrder.classList.remove("menu__order--visible"),popup.classList.remove("popup--hide"),cartWrapper.innerHTML="",calcCartPrice()}),close.addEventListener("click",()=>{menu.classList.remove("menu--visible"),popup.classList.add("popup--hide")}),order.addEventListener("click",()=>{menuOrder.classList.add("menu__order--visible"),cart.forEach(e=>{const t=`\n            <div class="cart-item order__item" data-id="${e.id}">\n                    <div class="cart-item__img order__img">\n                        <img src="${e.imgSrc}" alt="${e.title}">\n                    </div>\n                    <div class="cart-item__desc order__descr">\n                        <div class="cart-item__title">${e.title}</div>\n                        <div class="cart-item__weight">${e.itemsInBox} / ${e.weight}</div>\n\n                        <div class="cart-item__details">\n                            <div class="price">\n                                <div class="price__currency">${e.price}</div>\n                            </div>\n                        </div>\n                    </div>\n                  <div class="order__total"> x ${e.counter}</div>\n            </div>`;orderWrapper.insertAdjacentHTML("afterbegin",t)})}),closeOrder.addEventListener("click",()=>{menuOrder.classList.remove("menu__order--visible"),orderWrapper.innerHTML="",orderTotal.innerHTML=""}),getProducts(),window.addEventListener("click",(function(e){let t,r;if(e.target.closest(".cart-wrapper")&&(r=e.target.closest(".cart-item").dataset.id),"plus"===e.target.dataset.action||"minus"===e.target.dataset.action){t=e.target.closest(".counter-wrapper").querySelector("[data-counter]")}"plus"===e.target.dataset.action&&(t.innerText=++t.innerText,cart.map(e=>{e.id===r&&(e.counter++,console.log(cart))})),"minus"===e.target.dataset.action&&(parseInt(t.innerText)>1?(t.innerText=--t.innerText,cart.map(e=>{e.id===r&&e.counter--})):e.target.closest(".cart-wrapper")&&1===parseInt(t.innerText)&&(e.target.closest(".cart-item").remove(),cart.map((e,t)=>{e.id===r&&cart.splice(t,1)}),toggleCartStatus(),calcCartPrice())),e.target.hasAttribute("data-action")&&e.target.closest(".cart-wrapper")&&calcCartPrice()})),window.addEventListener("click",(function(e){if(e.target.hasAttribute("data-cart")){const t=e.target.closest(".card"),r={id:t.dataset.id,imgSrc:t.querySelector(".product-img").getAttribute("src"),title:t.querySelector(".item-title").innerText,itemsInBox:t.querySelector("[data-items-in-box]").innerText,weight:t.querySelector(".price__weight").innerText,price:t.querySelector(".price__currency").innerText,counter:t.querySelector("[data-counter]").innerText};cart.push(r);const n=cartWrapper.querySelector(`[data-id="${r.id}"]`);if(n){const e=n.querySelector("[data-counter]");e.innerText=parseInt(e.innerText)+parseInt(r.counter)}else{const e=`\n            <div class="cart-item" data-id="${r.id}">\n                <div class="cart-item__top">\n                    <div class="cart-item__img">\n                        <img src="${r.imgSrc}" alt="${r.title}">\n                    </div>\n                    <div class="cart-item__desc">\n                        <div class="cart-item__title">${r.title}</div>\n                        <div class="cart-item__weight">${r.itemsInBox} / ${r.weight}</div>\n\n                        <div class="cart-item__details">\n                            <div class="items items--small counter-wrapper">\n                                <div class="items__control" data-action="minus">-</div>\n                                <div class="items__current" data-counter="">${r.counter}</div>\n                                <div class="items__control" data-action="plus">+</div>\n                            </div>\n\n                            <div class="price">\n                                <div class="price__currency">${r.price}</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>`;cartWrapper.insertAdjacentHTML("beforeend",e)}t.querySelector("[data-counter]").innerText="1",toggleCartStatus(),calcCartPrice()}})),ymaps.ready(init);