const burger=document.querySelector(".burger"),close=document.querySelector(".menu__close"),menu=document.querySelector(".menu");burger.addEventListener("click",()=>{menu.classList.add("menu--visible")}),close.addEventListener("click",()=>{menu.classList.remove("menu--visible")});const productsContainer=document.querySelector(".products__items");async function getProducts(){const e=await fetch("./js/products.json");renderProducts(await e.json())}function renderProducts(e){e.forEach((function(e){const t=`\n    <div class="products__item">\n    <div class="products__wrapper" data-id="${e.id}">\n      <img class="product-img" src="img/roll/${e.imgSrc}" alt="">\n      <div class="card__body text-center">\n        <h4 class="item-title">${e.title}</h4>\n        <p><small data-items-in-box class="text-muted">6 шт.</small></p>\n\n        <div class="details-wrapper">\n          <div class="items counter-wrapper">\n            <div class="items__control" data-action="minus">-</div>\n            <div class="items__current" data-counter>1</div>\n            <div class="items__control" data-action="plus">+</div>\n          </div>\n\n          <div class="price">\n            <div class="price__weight">${e.weight}г.</div>\n            <div class="price__currency">${e.price} ₽</div>\n          </div>\n        </div>\n\n        <button data-cart type="button" class="btn btn-block btn-outline-warning">+ в корзину</button>\n\n      </div>\n    </div>\n  </div>\n    `;productsContainer.insertAdjacentHTML("beforeend",t)}))}function toggleCartStatus(){const e=document.querySelector(".cart-wrapper"),t=document.querySelector("[data-cart-empty]"),r=document.querySelector("#order-form");e.children.length>0?(t.classList.add("none"),r.classList.remove("none")):(t.classList.remove("none"),r.classList.add("none"))}function calcCartPrice(){const e=document.querySelector(".total-price"),t=document.querySelectorAll(".cart-item"),r=document.querySelector(".delivery-cost"),n=document.querySelector("[data-cart-delivery]");let c=0;t.forEach((function(e){const t=e.querySelector("[data-counter]"),r=e.querySelector(".price__currency"),n=parseInt(t.innerText)*parseInt(r.innerText);c+=n})),e.innerText=c,c>0?n.classList.remove("none"):n.classList.add("none"),c>=600?(r.classList.add("free"),r.innerText="бесплатно"):(r.classList.remove("free"),r.innerText="250 ₽")}getProducts(),window.addEventListener("click",(function(e){let t;if("plus"===e.target.dataset.action||"minus"===e.target.dataset.action){t=e.target.closest(".counter-wrapper").querySelector("[data-counter]")}"plus"===e.target.dataset.action&&(t.innerText=++t.innerText),"minus"===e.target.dataset.action&&(parseInt(t.innerText)>1?t.innerText=--t.innerText:e.target.closest(".cart-wrapper")&&1===parseInt(t.innerText)&&(e.target.closest(".cart-item").remove(),toggleCartStatus(),calcCartPrice())),e.target.hasAttribute("data-action")&&e.target.closest(".cart-wrapper")&&calcCartPrice()}));const cartWrapper=document.querySelector(".cart-wrapper");function init(){var e=new ymaps.Map("map",{center:[55.76,37.64],zoom:7,controls:["zoomControl"],behaviors:["drag"]}),t=document.querySelector(".myadress").innerHTML;ymaps.geocode(t,{results:1}).then((function(t){var r=t.geoObjects.get(0),n=(r.geometry.getCoordinates(),r.properties.get("boundedBy"));r.options.set("preset","islands#darkBlueDotIconWithCaption"),r.properties.set("iconCaption",r.getAddressLine()),myPlacemark=new ymaps.Placemark(r.geometry.getCoordinates(),{hintContent:"Собственный значок метки",balloonContent:"Это красивая метка"},{iconLayout:"default#image",iconImageSize:[60,60],iconImageOffset:[-40,-38]}),e.geoObjects.add(myPlacemark),e.setBounds(n,{checkZoomRange:!0})}))}window.addEventListener("click",(function(e){if(e.target.hasAttribute("data-cart")){const t=e.target.closest(".card"),r={id:t.dataset.id,imgSrc:t.querySelector(".product-img").getAttribute("src"),title:t.querySelector(".item-title").innerText,itemsInBox:t.querySelector("[data-items-in-box]").innerText,weight:t.querySelector(".price__weight").innerText,price:t.querySelector(".price__currency").innerText,counter:t.querySelector("[data-counter]").innerText},n=cartWrapper.querySelector(`[data-id="${r.id}"]`);if(n){const e=n.querySelector("[data-counter]");e.innerText=parseInt(e.innerText)+parseInt(r.counter)}else{const e=`\n            <div class="cart-item" data-id="${r.id}">\n                <div class="cart-item__top">\n                    <div class="cart-item__img">\n                        <img src="${r.imgSrc}" alt="${r.title}">\n                    </div>\n                    <div class="cart-item__desc">\n                        <div class="cart-item__title">${r.title}</div>\n                        <div class="cart-item__weight">${r.itemsInBox} / ${r.weight}</div>\n\n                        \x3c!-- cart-item__details --\x3e\n                        <div class="cart-item__details">\n\n                            <div class="items items--small counter-wrapper">\n                                <div class="items__control" data-action="minus">-</div>\n                                <div class="items__current" data-counter="">${r.counter}</div>\n                                <div class="items__control" data-action="plus">+</div>\n                            </div>\n\n                            <div class="price">\n                                <div class="price__currency">${r.price}</div>\n                            </div>\n\n                        </div>\n                        \x3c!-- // cart-item__details --\x3e\n\n                    </div>\n                </div>\n            </div>`;cartWrapper.insertAdjacentHTML("beforeend",e)}t.querySelector("[data-counter]").innerText="1",toggleCartStatus(),calcCartPrice()}})),ymaps.ready(init);